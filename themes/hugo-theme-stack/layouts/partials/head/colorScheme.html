{{- $defaultColorScheme := default "auto" .Site.Params.colorScheme.default -}}
{{- if not (default false .Site.Params.colorScheme.toggle) -}}
{{/* If toggle is disabled, force default scheme */}}
<script>
    (function () {
        const colorSchemeKey = 'StackColorScheme';
        localStorage.setItem(colorSchemeKey, "{{ $defaultColorScheme }}");
    })();
</script>
{{- else -}}
{{/* Otherwise set to default scheme based on Beijing time (UTC+8) if no preference is set by user */}}
{{/* Dark mode: 21:00 - 08:00 (next day), Light mode: 08:00 - 21:00 */}}
<script>
    (function () {
        const colorSchemeKey = 'StackColorScheme';
        if (!localStorage.getItem(colorSchemeKey)) {
            // 获取北京时间 (UTC+8)
            const now = new Date();
            const utcHour = now.getUTCHours();
            const beijingHour = (utcHour + 8) % 24;

            // 21:00-23:59 或 00:00-07:59 使用深色模式
            // 08:00-20:59 使用浅色模式
            const isDarkTime = beijingHour >= 21 || beijingHour < 8;
            const scheme = isDarkTime ? 'dark' : 'light';
            localStorage.setItem(colorSchemeKey, scheme);
        }
    })();
</script>
{{- end -}}

<script>
    (function () {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            /**
             * Enable dark mode if:
             * 1. If dark mode is set already (in local storage)
             * 2. Auto mode & prefere color scheme is dark
             */
            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>